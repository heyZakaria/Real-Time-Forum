<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <meta charset="UTF-8"> -->
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <title>websocket whit go</title>
</head>
<body>
    <div class="center">

        <h1>amazing chat application</h1>
             <h3 id="chat-header"> currently in chat:general</h3>
             <form id="chatroom-selection">
                
                <label for="chatrom">chatrom</label>
                <input type="text" id="chatrom" name="chatrom"> <br><br>
                <input type="submit" value="change chatrom">
                </form>
                <br>
                <textarea class=" meesagearea" id="chatmessages" readonly name="chatmessages"
                rows="4" cols="40" placeholder="welom to chatroom">
            </textarea>
                <br>

                <form id="chatroom-message">

                    <label for="message"> message:</label>
                    <input type="text" id="message" name="message"> <br><br>
                    <input type="submit" value="send message">
                </form>
             </form>



    </div>

<script>


class Event{
    constructor(type,playload){
        this.type=type
        this.playload=playload
    }
}

function routeEvent(event){
    if (event.type===undefined){
        alert('no type field in the event ');
    }
switch(event.type){

    case "new message": 
        console.log("new mesage")   
    default:
        alert("unsupported message typr");
        break
}
}


function sendEvent(eventName,playload){

    const event=new Event(eventName,playload)
    conn.send(JSON.stringify(event))

}










    var selectedChat="general";
    function changeChatRoom(){
        var newchat =document.getElementById("chatrom")
        if(newchat!=null&&newchat.value!=selectedChat ){
            console.log("newchat")
            // selectedChat=newchat.value
        }
        return false 
    }

    function sendMessage(){
        var newmessage =document.getElementById("message")
        if(newmessage!=null ){
            // console.log("newm")
            // selectedChat=newchat.value

           //conn.send(newmessage.value)

           sendEvent("send message",newmessage.value)

        }
        return false 

    }


    window.onload=function(){
        document.getElementById("chatroom-selection").onsubmit=changeChatRoom
        document.getElementById("chatroom-message").onsubmit=sendMessage

        if(window["WebSocket"]){
            console.log("support webscket")
            //connect to ws
            conn=new WebSocket("ws://"+document.location.host+"/ws")
            
            conn.onmessage=function(evt){
                // console.log(evt)

                const eventData=JSON.parse(evt.parse)
                const event =Object.assign(new Event,eventData)

                routeEvent(event)
            }
            
        
        }else{
            alert('browser does not support websocket')
        }
    }




</script>


<style type="text/css">

body{
    overflow: hidden;
    padding: 0;
    margin: 0;
    width: 100%;
    height: 100%;
    background-color:rgb(66, 56,56);

}
.center{
    margin: auto;
    width: 50%;
    border:3px solid green ;
    padding: 10px;

}

</style>


</body>
</html>